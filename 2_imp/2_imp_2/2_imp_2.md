# コンフィギュレーションを定義する方法

このレッスンで、kのコンフィギュレーションを定義する方法をみていきます。コンフィギュレーションを構成する物は「セル」と呼ばれます。セルは名前がついてあるXMLタグのようがあって、入れ子構造に書けます。コンフィギュレーションは`configuration`キーワードで宣言されます。慣例で、コンフィギュレーションは全体トップレベル`<T>`セルの中に包まれますが、これはkに強制されません。

```
    configuration <T>...</T>
```
意味論の規則は全部コンフィギュレーション対一致・適用して、「コンフィギュレーション抽象化」の真髄であるので、かなり大事であります。改めて、コンフィギュレーション抽象化っていうことは「意味論の規則を書くときに、変更されないセルは省略すればいい」ということだけです。第3章・第4章に達する前、コンフィギュレーション抽象化の価値が自明的にならないかもしれませんが、IMPを定義するためにもセルとコンフが必要なので、ここで導入します。

今回のIMPはセルが二つある言語として定義します。第一セルはプログラムの指示の残りを保持する`<k>`セルです。二番目のセルはプログラムの状態を保持する`<state>`セルです。加えましょう。

```
    configuration <T> <k>...</k> <state>...</state> </T>
```

コンフィギュレーションの初期状態も指定可能です。何かの項をコンフィギュレーションの初期状態に含めたければ、望みのセルに置いておくことだけで出来ます。

今回、`krun`へ渡されたプログラムが`<k>`セルの中に入れられた状態にしたいです。`$PGM`という特製変数はそのためkに提供されています。`krun`は`$PGM`の位置にい、パースされたプログラムを置いてくれます。いろんな初期状態を定義するため、自分のコンフィギュレーション変数も定義出来ますが、今回は`$PGM`だけ使います。

```
    configuration <T> <k> $PGM </k> <state>...</state>  </T>
```

`krun`へ渡されたことは本物のプログラムであることを確認するため、`$PGM`を`Pgm`構文カテゴリでタグします。このソート保証に対してもランタイムチェックが行われて、失敗になったら意味論が詰まってるようになってしまいます。

```
    configuration <T> <k> $PGM:Pgm </k> <state>...</state>  </T>
```

次に、`<state>`セルの初期内容を空のマップにします。

```
    configuration <T> <k> $PGM:Pgm </k> <state> .Map </state>  </T>
```

Kの文脈で`.`は*無*という意味の記号です。実はいろんな種類の「無」が存在するので明らかにするため`.`の直後に、種類を宣言することが優れたいい慣例です。この「無」は空のマップを表すので、`.Map`にしましょう。

自動的に作ったドキュメンテーションにある部品が見分けやすくなるために、XMLタグのアトリビュートとにたような物を使って細胞や部品を違う色にすることも出来ます。

```
configuration <T color="yellow">
                <k color="green"> $PGM:Pgm </k>
                <state color="red"> .Map </state>
              </T>
```

出来たら`imp.k`をコンパイルしてください。コンフィギュレーションの初期状態がは定義とあっているかどうかを確認するため、何かのプログラムを実行してみて。次のレッスンでセルを用いる書き換え規則の書き方を検査します。
